<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Invoice</title>

<style>
  body{
    font-family: Arial, sans-serif;
    background:#f5f5f5;
    padding:20px;
  }

  .toolbar{
    max-width:800px;
    margin:0 auto 10px;
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }

  .toolbar button{
    font-size:12px;
    padding:6px 10px;
    cursor:pointer;
  }

  .page{
    width:800px;
    background:#fff;
    margin:auto;
    padding:40px 45px 50px;
    border:1px solid #ccc;
  }

  .top{
    display:grid;
    grid-template-columns:1fr 1fr;
  }

  h4{ margin:0 0 6px; font-size:12px; }
  .line{ border-bottom:1px solid #000; width:260px; margin:6px 0 10px; }

  .billto div{ font-size:12px; line-height:1.4; }

  .invoiceBox{
    text-align:right;
    font-size:12px;
    font-weight:bold;
  }

  /* DATE under INVOICE */
  .invoiceBox .dateRow{
    margin-top:6px;
    padding-left:18px;
    font-weight:normal;
  }

  table{
    border-collapse:collapse;
    width:100%;
    margin-top:35px;
    font-size:11px;
  }

  th, td{
    border:1px solid #222;
    padding:4px 6px;
    text-align:center;
  }

  td:first-child{ text-align:left; }

  input, select{
    font-size:11px;
    padding:2px;
    width:100%;
    box-sizing:border-box;
  }

  .num{ font-variant-numeric: tabular-nums; }
  .money::before{ content:"$"; }

  .totals{
    width:220px;
    margin-left:auto;
    margin-top:20px;
    font-size:11px;
  }

  .totals div{
    display:flex;
    justify-content:space-between;
    margin-bottom:6px;
  }

  .box{
    border:1px solid #222;
    padding:4px 8px;
    min-width:80px;
    text-align:center;
    font-weight:bold;
  }

  .remarks{
    margin-top:40px;
    font-size:11px;
  }

  .remarks span{ margin-left:140px; }

  /* ARCHIVE PANEL */
  .archivePanel{
    display:none;
    max-width:800px;
    margin:10px auto;
    background:#fff;
    border:1px solid #ccc;
    padding:10px;
    font-size:11px;
  }

  .archiveRow{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:6px 4px;
    border-bottom:1px dotted #ccc;
  }

  .archiveRow span{
    cursor:pointer;
  }

  .archiveRow button{
    font-size:10px;
    padding:2px 6px;
  }

  /* PRINT CLEAN */
  @media print{
    .toolbar, .archivePanel{ display:none !important; }
    input, select{
      border:none !important;
      padding:0 !important;
      background:transparent !important;
      appearance:none;
    }
    body{ background:#fff; }
    @page{ size:A4; margin:12mm; }
  }
</style>
</head>

<body>

<div class="toolbar">
  <button onclick="fillDays(1,15)">Auto Fill 1–15</button>
  <button onclick="fillDays(16)">Auto Fill 16–End</button>
  <button onclick="newForm()">New Form</button>
  <button onclick="toggleArchive()">Archive</button>
  <button onclick="savePDF()">Save to PDF</button>
</div>

<div class="archivePanel" id="archivePanel"></div>

<div class="page">

  <div class="top">
    <div class="billto">
      <h4>BILL TO</h4>
      <div class="line"></div>
      <div>Sam Bilderback</div>
      <div>Spring Creek Appraisals</div>
      <div>TX</div>
      <div>(832) 810-1581</div>
      <div>sam.springcreekappraisal@gmail.com</div>
      <div>orders@springcreekappraisal.com</div>
    </div>

    <div class="invoiceBox">
      INVOICE
      <div class="dateRow">
        DATE:
        <input type="text" id="invoiceDate" style="width:110px;">
      </div>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>DATE</th>
        <th>TIME IN</th>
        <th>TIME OUT</th>
        <th>BREAK</th>
        <th>HOURS</th>
        <th>RATE</th>
        <th>TOTAL</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>

  <div class="totals">
    <div>
      <span>Total Net Pay</span>
      <span class="box money" id="netPay">0.00</span>
    </div>
    <div>
      <span>Total Hours</span>
      <span class="box" id="totalHours">0.00</span>
    </div>
  </div>

  <div class="remarks">
    <div style="color:#c40000;">Remarks / Payment Instructions:</div><br>
    <span contenteditable="true">wise tag is @celsomatigac</span>
  </div>

</div>

<script>
const RATE = 7;
const STORAGE_KEY = "invoice_archive";
const tbody = document.getElementById("rows");

function pad(n){ return String(n).padStart(2,"0"); }
function formatMDY(d){
  return `${pad(d.getMonth()+1)}/${pad(d.getDate())}/${d.getFullYear()}`;
}
function daysInMonth(y,m){
  return new Date(y, m+1, 0).getDate();
}

function fillDays(start, end){
  tbody.innerHTML="";
  const now = new Date();
  const y = now.getFullYear();
  const m = now.getMonth();
  const last = end || daysInMonth(y,m);

  for(let d=start; d<=last; d++){
    const dt = new Date(y,m,d);
    if(dt.getDay()==0 || dt.getDay()==6) continue;

    tbody.insertAdjacentHTML("beforeend", `
      <tr>
        <td><input type="text" value="${formatMDY(dt)}"></td>
        <td><input type="time" value="08:00"></td>
        <td><input type="time" value="17:00"></td>
        <td>
          <select>
            <option value="">Select</option>
            <option value="60">1 hr</option>
            <option value="30">30 min</option>
            <option value="0">Did not take a break</option>
          </select>
        </td>
        <td class="hours num">0.00</td>
        <td class="num money">${RATE}</td>
        <td class="total num money">0.00</td>
      </tr>
    `);
  }
  attachCalc();
}

function attachCalc(){
  document.querySelectorAll("input,select").forEach(el=>{
    el.onchange = calculate;
  });
}

function calculate(){
  let totalH=0, totalPay=0;

  document.querySelectorAll("#rows tr").forEach(tr=>{
    const ti = tr.children[1].querySelector("input").value;
    const to = tr.children[2].querySelector("input").value;
    const br = Number(tr.children[3].querySelector("select").value||0);
    let hrs=0;

    if(ti && to){
      let s = ti.split(":"), e = to.split(":");
      let m = (e[0]*60+ +e[1])-(s[0]*60+ +s[1])-br;
      if(m<0) m+=1440;
      hrs = m/60;
    }

    tr.querySelector(".hours").textContent=hrs.toFixed(2);
    tr.querySelector(".total").textContent=(hrs*RATE).toFixed(2);

    totalH+=hrs;
    totalPay+=hrs*RATE;
  });

  document.getElementById("totalHours").textContent=totalH.toFixed(2);
  document.getElementById("netPay").textContent=totalPay.toFixed(2);
}

/* ARCHIVE */
function newForm(){
  const archive = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
  archive.push({
    date: document.getElementById("invoiceDate").value,
    html: tbody.innerHTML,
    totalHours: document.getElementById("totalHours").textContent,
    netPay: document.getElementById("netPay").textContent
  });
  localStorage.setItem(STORAGE_KEY, JSON.stringify(archive));

  document.getElementById("invoiceDate").value = formatMDY(new Date());
  document.getElementById("totalHours").textContent = "0.00";
  document.getElementById("netPay").textContent = "0.00";
  fillDays(1,15);
}

function toggleArchive(){
  const panel = document.getElementById("archivePanel");
  panel.innerHTML="";
  const archive = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

  archive.forEach((a,i)=>{
    const row = document.createElement("div");
    row.className="archiveRow";

    const label = document.createElement("span");
    label.textContent = `Invoice ${a.date} — $${a.netPay}`;
    label.onclick = ()=>{
      tbody.innerHTML = a.html;
      document.getElementById("invoiceDate").value = a.date;
      document.getElementById("totalHours").textContent = a.totalHours;
      document.getElementById("netPay").textContent = a.netPay;
      attachCalc();
      panel.style.display="none";
    };

    const del = document.createElement("button");
    del.textContent="Delete";
    del.onclick = ()=>{
      if(confirm("Delete this archived invoice?")){
        archive.splice(i,1);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(archive));
        toggleArchive();
      }
    };

    row.appendChild(label);
    row.appendChild(del);
    panel.appendChild(row);
  });

  panel.style.display = panel.style.display==="block" ? "none" : "block";
}

function savePDF(){
  window.print();
}

/* INIT */
document.getElementById("invoiceDate").value = formatMDY(new Date());
fillDays(1,15);
</script>

</body>
</html>